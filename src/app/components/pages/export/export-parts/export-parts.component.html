<div
  *ngIf="alertClass && alertMessage"
  class="{{ alertClass }} mt-3 text-center"
  role="alert"
>
  <b> {{ alertMessage }} </b>
</div>

<div class="container" *ngIf="!fileUploadStart">
  <div class="col-md-12 col-sm-12">
    <h4><strong>Export Data</strong></h4>
    <div class="instructions">
      <li>
        Upload a CSV that has all the Part Numbers you want to export
        Descriptions for.
      </li>
      <li>
        All Part Numbers must be in a single column; only one column (that you
        choose) will be matched.
      </li>
      <li>
        The first row will be used as the column header and will not be matched
        and exported.
      </li>
      <li>Please note that you can only process one csv file at a time.</li>
    </div>
  </div>
  <div class="col-md-12 col-sm-12">
    <div
      class="fileDragContainer"
      appDraganddrop
      (fileDropped)="onFileDropped($event)"
    >
      <input
        type="file"
        #fileDropRef
        id="fileDropRef"
        (change)="fileBrowseHandler($event.target.files)"
        accept=".csv"
      />
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="63"
        height="64"
        viewBox="0 0 63 64"
      >
        <g fill="#3B454F" fill-rule="nonzero">
          <path
            d="M42.656 15.135a1.953 1.953 0 0 1-1.391-.578L31.5 4.795l-9.765 9.762a1.97 1.97 0 1 1-2.785-2.785L30.106.616a1.97 1.97 0 0 1 2.785 0l11.157 11.156a1.97 1.97 0 0 1-1.392 3.363z"
          />
          <path
            d="M31.5 36.791a1.97 1.97 0 0 1-1.969-1.969V2.01a1.97 1.97 0 0 1 3.938 0v32.812a1.97 1.97 0 0 1-1.969 1.969z"
          />
          <path
            d="M55.781 63.041H7.22A7.225 7.225 0 0 1 0 55.822V41.385a4.599 4.599 0 0 1 4.594-4.594h7.234a4.567 4.567 0 0 1 4.402 3.276l2.814 9.382a.658.658 0 0 0 .628.467h23.656a.658.658 0 0 0 .628-.467l2.814-9.385a4.572 4.572 0 0 1 4.402-3.273h7.234A4.599 4.599 0 0 1 63 41.385v14.437a7.225 7.225 0 0 1-7.219 7.219zM4.594 40.729a.656.656 0 0 0-.657.656v14.437a3.286 3.286 0 0 0 3.282 3.282H55.78a3.286 3.286 0 0 0 3.282-3.282V41.385a.656.656 0 0 0-.657-.656h-7.234a.65.65 0 0 0-.628.467L47.73 50.58a4.628 4.628 0 0 1-4.402 3.274H19.672a4.567 4.567 0 0 1-4.402-3.276l-2.814-9.382a.65.65 0 0 0-.628-.467H4.594z"
          />
        </g>
      </svg>
      <h3 class="mt-3">Drag and drop a .csv here</h3>
      <h3>or</h3>
      <label for="fileDropRef">Browse for file</label>
    </div>
  </div>
</div>

<div class="container" *ngIf="fileUploadStart">
  <div class="col-md-12 col-sm-12">
    <div class="files-list">
      <div class="single-file" *ngFor="let file of files; let i = index">
        <div class="info">
          <div class="file-meta-info">
            <img src="assets/csv.png" width="50px" height="50px" />
            <h4 class="name">
              {{ file?.name }}
            </h4>
            <p class="size">
              {{ formatBytes(file?.size) }}
            </p>
          </div>
          <h2 class="bold text-center">Uploading {{ file?.progress }} %</h2>
          <app-progress [progress]="file?.progress"></app-progress>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container" *ngIf="showMatchColumnsView">
  <div
    *ngIf="alertClass && alertMessage"
    class="{{ alertClass }} mt-3 text-center"
    role="alert"
  >
    <b> {{ alertMessage }} </b>
  </div>
  <div class="fileDragContainer" *ngIf="showSendingCSVDataProgress.state">
    <div class="info">
      <h2 class="bold text-center">
        Uploading {{ showSendingCSVDataProgress.progress }} %
      </h2>
      <app-progress
        [progress]="showSendingCSVDataProgress.progress"
      ></app-progress>
    </div>
  </div>
  <div *ngIf="!showSendingCSVDataProgress.state">
    <div>
      <div class="pull-left">
        <h3 class="font-weight-bold">Match Columns</h3>
        <h5>Filename: {{ csvFileName }}</h5>
      </div>
      <div class="pull-right">
        <button
          class="btn btn-dark btn-lg font-weight-bold"
          (click)="importData()"
        >
          Import
        </button>
        <button
          class="btn btn-light btn-lg ml-2 font-weight-bold"
          (click)="cancelImport()"
        >
          Cancel
        </button>
      </div>
    </div>
    <table
      class="table table-bordered"
      *ngFor="let column of headerColumns; let index = index"
    >
      <thead>
        <tr>
          <th colspan="2" style="width: 40%">
            {{ column }}
            <small
              >(Column {{ (index + 1 + 9).toString(36).toUpperCase() }})</small
            >
          </th>
          <th colspan="4" style="width: 60%">
            File Data <small>(first 5 rows)</small>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="2">
            <div class="ml-2">
              <label class="mb-2 font-weight-bold">Match to:</label>
              <select
                class="form-control"
                name="select-{{ column }}"
                id="select-{{ column }}"
                [(ngModel)]="csvDataRules[column]['matchTo']"
              >
                <option value="skip" selected>Skip Column</option>
                <option value="part_number">Part Number</option>
                <option value="description_en">Description - EN</option>
                <option value="description_es">Description - ES</option>
                <option value="description_fr">Description - FR</option>
                <option value="quantity">Quantity</option>
              </select>
              <label class="mt-2 mb-2 font-weight-bold">Empty Values:</label>
              <form>
                <label class="radio-inline">
                  <input
                    type="radio"
                    name="empty_value"
                    checked
                    value="ignore"
                    [(ngModel)]="csvDataRules[column]['emptyValue']"
                  />&nbsp;&nbsp;Ignore
                </label>
                &nbsp;&nbsp;
                <label class="radio-inline">
                  <input
                    type="radio"
                    name="empty_value"
                    value="erase"
                    [(ngModel)]="csvDataRules[column]['emptyValue']"
                  />&nbsp;&nbsp;Erase existing
                </label>
              </form>
              <label class="mt-2 mb-2 font-weight-bold">Modified Values:</label>
              <form>
                <label class="radio-inline">
                  <input
                    type="radio"
                    name="modified_value"
                    value="original"
                    [(ngModel)]="csvDataRules[column]['modifiedValue']"
                  />&nbsp;&nbsp;Keep Original
                </label>
                &nbsp;&nbsp;
                <label class="radio-inline">
                  <input
                    type="radio"
                    name="modified_value"
                    value="overwrite"
                    [(ngModel)]="csvDataRules[column]['modifiedValue']"
                  />&nbsp;&nbsp;Overwrite
                </label>
              </form>
            </div>
          </td>
          <td colspan="4">
            <table class="table" style="border: none">
              <tbody>
                <tr *ngFor="let columnValue of csvData | slice: 0:5">
                  <td>{{ columnValue[column] }}</td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
